name: Node.js CI/CD Pipeline

on:
  push:
    branches: [ main ] # This triggers the workflow whenever you push to the main branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository code
      uses: actions/checkout@v4

    - name: Set up Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version: '20.x' # Use your specific Node.js version, e.g., '18.x' or '20.x'

    - name: Install dependencies
      run: npm install

    # Optional: If you have tests, uncomment the following step:
    # - name: Run tests
    #   run: npm test

    - name: Deploy to AWS EC2 Server via SSH
      uses: appleboy/ssh-action@v0.1.5
      with:
        # These values must match the SECRET names you set in GitHub repository settings
        host: ${{ secrets.SERVER_HOST }} 
        username: ${{ secrets.SERVER_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          # --- Remote Server Commands ---
          cd /var/www/express-node # Change this to your exact project directory on the server
          git pull origin main
          npm install
          # Restart your application service (e.g., using pm2 or systemd)
          # Example using pm2:
          # pm2 restart app.js 
